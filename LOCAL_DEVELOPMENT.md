# ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºã‚¬ã‚¤ãƒ‰

## æ¦‚è¦
Firebase Functions v2ã‚’ä½¿ç”¨ã—ãŸGemini AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ ã®ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã¨ãƒ†ã‚¹ãƒˆæ–¹æ³•

## ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### 1. ãƒ†ã‚¹ãƒˆã‚µãƒ¼ãƒãƒ¼èµ·å‹•
```bash
# ãƒãƒ¼ãƒˆç«¶åˆã‚’è‡ªå‹•å›é¿ã—ã¦ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼èµ·å‹•
./start-test-server.sh
```

### 2. ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãƒ†ã‚¹ãƒˆ
```bash
# åˆ¥ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§å®Ÿè¡Œ
./test-endpoints.sh
```

## ğŸ“‹ è©³ç´°ãªä½¿ç”¨æ–¹æ³•

### ãƒ†ã‚¹ãƒˆã‚µãƒ¼ãƒãƒ¼èµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆ (`start-test-server.sh`)

#### æ©Ÿèƒ½
- æ—¢å­˜ã®Firebaseãƒ—ãƒ­ã‚»ã‚¹æ¤œå‡ºãƒ»åœæ­¢
- ãƒãƒ¼ãƒˆç«¶åˆãƒã‚§ãƒƒã‚¯
- è‡ªå‹•ãƒ“ãƒ«ãƒ‰å®Ÿè¡Œ
- ã‚«ã‚¹ã‚¿ãƒ ãƒãƒ¼ãƒˆè¨­å®š
- è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«è‡ªå‹•å¾©å…ƒ

#### ä½¿ç”¨ãƒãƒ¼ãƒˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
- **Functions**: 5555 (æ¨™æº–: 5001)
- **UI**: 4444 (æ¨™æº–: 4000)
- **Auth**: 9999 (æ¨™æº–: 9099)
- **Firestore**: 8888 (æ¨™æº–: 8080)

#### ã‚¢ã‚¯ã‚»ã‚¹URL
- Functions: http://localhost:5555
- UI: http://localhost:4444

### ãƒãƒ¼ãƒˆè¨­å®šã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

#### æ–¹æ³•1: ç’°å¢ƒå¤‰æ•°
```bash
FUNCTIONS_PORT=6666 UI_PORT=5555 ./start-test-server.sh
```

#### æ–¹æ³•2: è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ç·¨é›†
`local-ports.config`ã‚’ç·¨é›†:
```bash
FUNCTIONS_PORT=6666
UI_PORT=5555
AUTH_PORT=8888
FIRESTORE_PORT=7777
```

### ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ (`test-endpoints.sh`)

#### ãƒ†ã‚¹ãƒˆå¯¾è±¡
1. **GET /getagentinfo** - ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæƒ…å ±å–å¾—
2. **POST /processagentrequest** - ã‚¿ã‚¹ã‚¯å‡¦ç†
3. **POST /chat** - ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½

#### å®Ÿè¡Œä¾‹
```bash
./test-endpoints.sh
```

#### å‡ºåŠ›ä¾‹
```
ğŸ§ª Firebase Functions ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãƒ†ã‚¹ãƒˆ
==================================================
ãƒ™ãƒ¼ã‚¹URL: http://localhost:5555

ãƒ†ã‚¹ãƒˆ: ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæƒ…å ±å–å¾—
URL: http://localhost:5555/getagentinfo
Method: GET
Status: 200
Response: {"success":true,"agents":[...]}
âœ… ãƒ†ã‚¹ãƒˆæˆåŠŸ
```

## ğŸ”§ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œ

#### 1. ãƒãƒ¼ãƒˆç«¶åˆã‚¨ãƒ©ãƒ¼
```
Error: Port 5001 is already in use
```
**è§£æ±ºç­–**: 
- `start-test-server.sh`ãŒè‡ªå‹•çš„ã«ä»£æ›¿ãƒãƒ¼ãƒˆã‚’ä½¿ç”¨
- ã¾ãŸã¯`local-ports.config`ã§ãƒãƒ¼ãƒˆã‚’å¤‰æ›´

#### 2. ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼èµ·å‹•å¤±æ•—
```
Error: Failed to start emulator
```
**è§£æ±ºç­–**:
1. æ—¢å­˜ãƒ—ãƒ­ã‚»ã‚¹ç¢ºèª: `ps aux | grep firebase`
2. ãƒ—ãƒ­ã‚»ã‚¹åœæ­¢: `pkill -f firebase`
3. å†èµ·å‹•: `./start-test-server.sh`

#### 3. ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼
```
Error: Build failed
```
**è§£æ±ºç­–**:
1. ä¾å­˜é–¢ä¿‚ç¢ºèª: `npm install`
2. TypeScriptç¢ºèª: `npm run build`
3. è¨­å®šç¢ºèª: `tsconfig.json`

#### 4. æ¥ç¶šã‚¨ãƒ©ãƒ¼
```
âŒ æ¥ç¶šã‚¨ãƒ©ãƒ¼ï¼ˆã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ãŒèµ·å‹•ã—ã¦ã„ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ï¼‰
```
**è§£æ±ºç­–**:
1. ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼èµ·å‹•ç¢ºèª
2. ãƒãƒ¼ãƒˆç¢ºèª: `lsof -i :5555`
3. ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«è¨­å®šç¢ºèª

### ãƒ‡ãƒãƒƒã‚°æ–¹æ³•

#### 1. ãƒ­ã‚°ç¢ºèª
```bash
# ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ãƒ­ã‚°
firebase emulators:start --only functions --debug

# é–¢æ•°ãƒ­ã‚°
curl http://localhost:5555/getagentinfo
```

#### 2. æ‰‹å‹•ãƒ†ã‚¹ãƒˆ
```bash
# GET ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
curl -X GET http://localhost:5555/getagentinfo

# POST ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
curl -X POST http://localhost:5555/chat \
  -H "Content-Type: application/json" \
  -d '{"message":"ãƒ†ã‚¹ãƒˆ","sessionId":"test"}'
```

#### 3. ãƒ–ãƒ©ã‚¦ã‚¶ãƒ†ã‚¹ãƒˆ
- UI: http://localhost:4444
- Functions: http://localhost:5555

## ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
gemini-firebase-agent/
â”œâ”€â”€ start-test-server.sh      # ãƒ†ã‚¹ãƒˆã‚µãƒ¼ãƒãƒ¼èµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”œâ”€â”€ test-endpoints.sh         # ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”œâ”€â”€ local-ports.config        # ãƒãƒ¼ãƒˆè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ firebase.json             # Firebaseè¨­å®š
â”œâ”€â”€ .env                      # ç’°å¢ƒå¤‰æ•°ï¼ˆæœ¬ç•ªç”¨ï¼‰
â”œâ”€â”€ src/                      # ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰
â”‚   â”œâ”€â”€ index.ts             # ãƒ¡ã‚¤ãƒ³é–¢æ•°
â”‚   â””â”€â”€ agents/              # ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè£…
â””â”€â”€ lib/                      # ãƒ“ãƒ«ãƒ‰å‡ºåŠ›
```

## ğŸ”„ é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

### 1. é–‹ç™ºé–‹å§‹
```bash
# 1. ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼èµ·å‹•
./start-test-server.sh

# 2. åˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
./test-endpoints.sh
```

### 2. ã‚³ãƒ¼ãƒ‰å¤‰æ›´
```bash
# 1. ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ç·¨é›†
vim src/index.ts

# 2. è‡ªå‹•ãƒªãƒ“ãƒ«ãƒ‰ï¼ˆã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼èµ·å‹•ä¸­ã¯è‡ªå‹•ï¼‰
# ã¾ãŸã¯æ‰‹å‹•ãƒ“ãƒ«ãƒ‰
npm run build
```

### 3. ãƒ†ã‚¹ãƒˆ
```bash
# ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãƒ†ã‚¹ãƒˆ
./test-endpoints.sh

# å€‹åˆ¥ãƒ†ã‚¹ãƒˆ
curl -X GET http://localhost:5555/getagentinfo
```

### 4. ãƒ‡ãƒ—ãƒ­ã‚¤æº–å‚™
```bash
# 1. ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼åœæ­¢ (Ctrl+C)
# 2. æœ¬ç•ªãƒ“ãƒ«ãƒ‰
npm run build
# 3. ãƒ‡ãƒ—ãƒ­ã‚¤
firebase deploy --only functions
```

## ğŸ›¡ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ³¨æ„äº‹é …

### ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºæ™‚
- `.env`ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’å«ã‚ãªã„
- Firebase Secretsã‚’ä½¿ç”¨
- ãƒ­ãƒ¼ã‚«ãƒ«ãƒãƒ¼ãƒˆã¯å¤–éƒ¨å…¬é–‹ã—ãªã„

### æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤å‰
- å…¨ãƒ†ã‚¹ãƒˆãƒ‘ã‚¹ç¢ºèª
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ç¢ºèª
- CORSè¨­å®šç¢ºèª

## ğŸ“š å‚è€ƒãƒªãƒ³ã‚¯

- [Firebase Functions v2 ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://firebase.google.com/docs/functions/2nd-gen)
- [Firebase ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼](https://firebase.google.com/docs/emulator-suite)
- [devrule.md](./devrule.md) - v1â†’v2ç§»è¡Œè¦ç¯„

---

**æœ€çµ‚æ›´æ–°**: 2025-05-26  
**ä½œæˆè€…**: Firebase Functions v1â†’v2ç§»è¡Œãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ 